var A=Object.defineProperty;var I=(c,a,t)=>a in c?A(c,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):c[a]=t;var n=(c,a,t)=>(I(c,typeof a!="symbol"?a+"":a,t),t);import{A as F,a as x,C,c as e,i as h,j as k,g as p,S as f,d as P,p as b,u}from"./index.d57021e8.js";import{i as U}from"./datatable.4b22066f.js";import{B as R}from"./button.d257158a.js";/* empty css                 */import{m as V}from"./map-actions.609b7ae0.js";import"./jquery.4c77f39d.js";const W=(c,a,t,i=null)=>({url:F+(i||"/lecture/courses"),table:[{title:"No",data:"id",name:"id",searchable:!1,orderable:!1,width:"5%",mRender:(s,r,l,g)=>g.row+g.settings._iDisplayStart+1},{title:"Kode",data:"course.code",name:"course.code"},{title:"Nama",data:"course.name",name:"course.name",mRender(s,r,l){return`<span class="d-block font-weight-bold"><b>${s}</b></span><small>${l.course.name_en==null?"-":l.course.name_en}</small>`}},{title:"SKS",data:"credit_total",name:"credit_total"},{title:"SMT",data:"semester",name:"semester"},{title:"Status",data:"is_mandatory",name:"is_mandatory",mRender(s,r,l){return s?"W":"P"}},{title:"",data:"id",name:"id",searchable:!1,orderable:!1,sClass:"text-center nowrap",mRender:(s,r,l,g)=>{let N="";return x().includes("update-course-curiculums")&&(N+=`<button type="button" class="btn btn-outline-primary btn-sm mx-1" data-toggle="edit" data-curriculum-id=${l.curriculum_id} data-id="${s}"><i class="bx bx-edit-alt"></i></button>`),x().includes("delete-course-curiculums")&&(N+=`<button type="button" class="btn btn-outline-danger btn-sm mx-1" data-toggle="delete" data-curriculum-id=${l.curriculum_id} data-id="${s}"><i class="bx bx-trash"></i></button>`),N}}],callback:()=>{$('button[data-toggle="edit"]').unbind().on("click",function(s){s.preventDefault(),c($(this).data("id"),$(this).data("curriculum-id"))}),$('button[data-toggle="delete"]').unbind().on("click",function(s){s.preventDefault(),a($(this).data("id"),$(this).data("curriculum-id"))})}});class D extends C{render(){return e("div",{className:"modal fade",id:"curriculum-modal",role:"dialog"},e("div",{className:"modal-dialog",role:"document"},e("div",{className:"modal-content"},e("form",{onsubmit:this.props.onsubmit},e("div",{className:"modal-header bg-light pb-2"},e("h5",{className:"modal-title"},this.props.title)),e("div",{className:"modal-body"},e("input",{type:"hidden",name:"academic_period_id",value:this.props.academicPeriodId}),e("div",{className:"mb-3"},e("label",{htmlFor:"name",className:"form-label"},"Nama Kurikulum ",e("i",{className:"text-danger"},"*")),e("input",{type:"text",name:"name",placeholder:"Nama Kurikulum",autoComplete:"off",id:"name",className:"form-control"})),e("div",{className:"mb-3"},e("label",{htmlFor:"mandatory-credit",className:"form-label"},"SKS Wajib ",e("i",{className:"text-danger"},"*")),e("input",{type:"number",name:"mandatory_credit",placeholder:"SKS Wajib",onKeyUp:this.countCreditTotal,autoComplete:"off",id:"mandatory-credit",className:"form-control"})),e("div",{className:"mb-3"},e("label",{htmlFor:"choice-credit",className:"form-label"},"SKS Pilihan"),e("input",{type:"number",name:"choice_credit",placeholder:"SKS Pilihan",autoComplete:"off",onKeyUp:this.countCreditTotal,id:"choice-credit",className:"form-control"})),e("label",{htmlFor:""},"Total SKS : ",e("span",{className:"sks-total"},"0")),e("input",{type:"hidden",name:"study_program_id",value:this.studyProgramId,id:"study-program-id-modal"})),e("div",{className:"modal-footer"},e("button",{type:"button",className:"btn btn-light","data-bs-dismiss":"modal"},"Batal"),e("button",{type:"submit",className:"btn btn-primary","data-form-loading":!0},e("i",{className:"bx bx-save"})," Simpan"))))))}countCreditTotal(){$(".sks-total").html(parseInt($("#mandatory-credit").val()||0)+parseInt($("#choice-credit").val()||0))}}n(D,"defaultProps",{onsubmit:null,title:"Untitled Modal",studyProgramId:"",academicPeriodId:null});class M extends C{render(){return e("div",{className:"modal fade",id:"course-curriculum-modal",role:"dialog"},e("div",{className:"modal-dialog",role:"document"},e("div",{className:"modal-content"},e("form",{onsubmit:this.props.onsubmit},e("div",{className:"modal-header bg-light pb-2"},e("h5",{className:"modal-title"},this.props.title)),e("div",{className:"modal-body"},e("div",{className:"mb-3",id:"course-id"},e("label",{htmlFor:"course-id",className:"from-label"},"Mata Kuliah ",e("span",{className:"text-danger"},"*")),e("select",{name:"course_id",id:"course-id",className:"form-control js-choices"},e("option",{value:""},"Pilih Mata Kuliah"),this.props.courses.map(a=>e("option",{value:a.id},a.code," - ",a.name)))),e("div",{className:"mb-3"},e("label",{htmlFor:"semester",className:"form-label"},"Semester ",e("i",{className:"text-danger"},"*")),e("select",{name:"semester",id:"curriculum-course-type",className:"form-control"},[...Array(this.props.maxSemester.toString()*1)].map((a,t)=>e("option",{value:t+1},t+1)))),e("div",{className:"mb-3"},e("label",{htmlFor:"curriculum-course-type",className:"from-label"},"Jenis MK Kurikulum ",e("span",{className:"text-danger"},"*")),e("select",{name:"is_mandatory",id:"curriculum-course-type",className:"form-control js-choices"},e("option",{value:""},"Pilih Jenis MK Kurikulum"),e("option",{value:"true"},"Mata Kuliah Wajib"),e("option",{value:"false"},"Mata Kuliah Pilihan"))),e("input",{type:"hidden",name:"curriculum_id",value:""})),e("div",{className:"modal-footer"},e("button",{type:"button",className:"btn btn-light","data-bs-dismiss":"modal"},"Batal"),e("button",{type:"submit",className:"btn btn-primary","data-form-loading":!0},e("i",{className:"bx bx-save"})," Simpan"))))))}}n(M,"defaultProps",{onsubmit:null,title:"Untitled Modal",academicPeriods:[],courses:[],maxSemester:0});const[v,S]=u(""),[_,L]=u(""),m="lecture/curriculums",[d,w]=u(""),[o,K]=u(""),[q,B]=u("Tambah Kurikulum Baru"),[E,T]=u(""),[y,j]=u(""),[H,J]=u();class Y extends C{render(){var a,t;return e("div",{className:"intro-y"},e("div",{className:"row"},e("div",{className:"col-12"},e("div",{className:"page-title-box d-sm-flex align-items center justify-content-between"},e("h4",{className:"mb-sm-0"},(a=this.meta.title)!=null?a:"Untitled Page"),e("div",{className:"page-title-right"},e("div",{className:"breadcrumb"},e("li",{className:"breadcrumb-item"},e("router-link",{link:"apps.dashboard"},"Dashboard")),e("li",{className:"breadcrumb-item"},"Perkuliahan"),e("li",{className:"breadcrumb-item"},"Data Kelas"),e("li",{className:"breadcrumb-item active"},(t=this.meta.title)!=null?t:"Untitled Page")))))),e("div",{className:"card dt-filter-card",style:"display: block"},e("div",{className:"card-body"},e("div",{className:"row"},e("div",{className:"col-6"},e("label",{htmlFor:""},"Program Studi"),e("select",{name:"study_program_id",id:"study-program-id",className:"from-control js-choices custom-dt-filter-input",onChange:i=>{w(i.target.value),this.filterCurriculum()}},e("option",{value:""},"Pilih Prodi"),this.studyPrograms.map(i=>e("option",{value:i.id,selected:i.id==d},i.education_level.code," - ",i.name)))),e("div",{className:"col-6"},e("label",{htmlFor:""},"Periode Akademik"),e("select",{name:"academic_year_id",id:"academic-year-id",className:"from-control js-choices custom-dt-filter-input",onChange:i=>{K(i.target.value),this.filterCurriculum()}},e("option",{value:""},"Pilih Tahun Akademik"),this.academicPeriods.map(i=>e("option",{value:i.hashid,selected:i.hashid==o},i.name))))))),k(["create-curriculums","update-curriculums"])?e(D,{onsubmit:this.submit,title:q,studyProgramId:d,academicPeriodId:o,academicPeriods:this.academicPeriods}):"",k(["create-course-curiculums","update-course-curiculums"])?e(M,{onsubmit:this.submitCourseCurriculum,title:E,courses:this.courses,curriculumId:y,academicPeriods:this.academicPeriods,maxSemester:H}):"",e("div",{className:"card"},e("div",{className:"card-header border-0"},e("div",{className:"text-sm-end text-center"},e("div",{className:"dt-actions d-inline"}),e(R,{data:{redirect:!1,onclick:this.createCurriculum,refresh:!1,filter:!0,title:"Tambah Kurikulum",permission:"create-curriculums"}})))),e("div",{className:"row"},this.curriculums.length>0?this.curriculums.map(i=>{var s;return e("div",{className:"col-md-6"},e("div",{className:"card"},e("div",{className:"card-header"},e("div",{className:"d-flex justify-content-between"},e("div",{className:"left"},e("span",{className:"card-title d-block"},i.name),e("small",{className:"d-block"},"Periode : ",(s=i.academic_period)==null?void 0:s.name)),e("div",{className:"right"},h("delete-curriculums")?e("button",{type:"button",className:"btn btn-outline-danger me-1","data-curriculum-id":i.id,onclick:r=>{this.deleteData(r)}},e("i",{"data-curriculum-id":i.id,class:"bx bx-trash-alt"})):"",h("update-curriculums")?e("button",{type:"button",className:"btn btn-primary","data-curriculum-id":i.id,onclick:r=>{this.editData(r)}},e("i",{"data-curriculum-id":i.id,class:"bx bxs-pencil"})):""))),e("div",{className:"card-body"},e("div",{className:"table-responsive table-card mb-1 table-no-search"},e("div",{className:"text-end mt-3 me-3"},h("create-course-curiculums")?e("button",{className:"btn btn-primary","data-curriculum-id":i.id,onclick:r=>{this.createCourseCurriculum(r)}},"Tambah MK"):""),e("table",{className:"table zero-configuration",width:"100%",id:`data-${i.id}`,"data-curriculum-id":i.id}))),e("div",{className:"card-footer"},e("p",{className:"mb-0"},"SKS Wajib : ",e("span",{className:"used-mandatory-credit","data-cid":i.id},i.used_mandatory_credit)," / ",e("span",{className:"total-mandatory-credit","data-cid":i.id},i.mandatory_credit)),e("p",{className:"mb-0"},"SKS Pilihan : ",e("span",{className:"used-choice-credit","data-cid":i.id},i.used_choice_credit)," / ",e("span",{className:"total-choice-credit"},i.choice_credit)))))}):o==""||d==""?e("div",{className:"text-center mb-5"},e("img",{src:"/assets/images/relax.svg",style:"width: 100%; max-width: 400px"}),e("h3",null,"A Fresh Start!"),e("p",null,"Silahkan pilih program studi dan tahun akademik dari selector diatas")):e("div",{className:"text-center mb-5"},e("img",{src:"/assets/images/relax.svg",style:"width: 100%; max-width: 400px"}),e("h3",null,"Tidak Ada Data Ditampilkan"),e("p",null,"Tidak ada data yang cocok dengan kriteria pencarian anda"),h("create-curriculums")?e("button",{className:"btn btn-primary",onclick:this.createCurriculum},"Buat Kurikulum Baru"):"")))}async componentWillMount(){const{data:a}=await this.getData({model:["studyPrograms","courses"]}),t=await this.getAcademicPeriods("is_active=true");K(""),w(""),this.academicPeriods=t.data.academicPeriods,this.studyPrograms=a.studyPrograms,this.courses=a.courses}async filterCurriculum(){if(d!=""&&o!=""){const{data:a}=await p(`${m}?${new URLSearchParams({study_program_id:d,academic_period_id:o}).toString()}`,{hideSuccessNotification:!0});this.setState(()=>{var t,i,s,r;this.curriculums=a==null?void 0:a.curriculum,J((r=(s=(i=(t=a.curriculum[0])==null?void 0:t.study_program)==null?void 0:i.education_level)==null?void 0:s.education_level_setting)==null?void 0:r.max_study)})}}createCurriculum(){d!=""&&o!=""?(B("Tambah Kurikulum Baru"),S(""),$(".js-choices")[2].choices.setChoiceByValue(""),$('input[name="name"]').val(""),$('input[name="mandatory_credit"]').val("").trigger("keyup"),$('input[name="choice_credit"]').val("").trigger("keyup"),$('input[name="study_program_id"]').val(""),$("#curriculum-modal").modal("show")):f.fire("Kesalahan","Pilih Program Studi dan Tahun Akademik Terlebih Dahulu !","warning")}createCourseCurriculum(a){$("#course-id").show(),T("Tambah Mata Kuliah Kurikulum"),$(".js-choices")[2].choices.setChoiceByValue(""),$(".js-choices")[3].choices.setChoiceByValue(""),$('input[name="curriculum_id"]').val(""),$('input[name="semester"]').val(""),j($(a.target).data("curriculum-id")),$("#course-curriculum-modal").modal("show")}async editCourseCurriculum(a,t){$("#course-id").hide(),L(a),T("Edit Mata Kuliah Kurikulum");const{data:i}=await p(`lecture/course-curriculums/${_}`,{hideSuccessNotification:!0,hideLoadingBar:!0});j(t),$('input[name="curriculum_id"]').val(i.courseCurriculum.curriculum_id),$(".js-choices")[2].choices.setChoiceByValue(i.courseCurriculum.course_id),$('input[name="semester"]').val(i.courseCurriculum.semester),$(".js-choices")[3].choices.setChoiceByValue(i.courseCurriculum.is_mandatory?"true":"false"),$("#course-curriculum-modal").modal("show")}async deleteCourseCurriculum(a,t){f.fire({title:"Hapus ?",icon:"question",text:"Data yang dihapus tidak dikembalikan!",showConfirmButton:!0,showCancelButton:!0,confirmButtonText:"Ya, lanjutkan",cancelButtonText:"Batal",confirmButtonColor:"#d1403b"}).then(async i=>{i.isConfirmed&&(await P(`lecture/course-curriculums/${a}`),this.recountCreditTotal(t),this.tables[t].ajax.reload())})}async recountCreditTotal(a){const{data:t}=await p(`lecture/curriculums/${a}/get-credit-count`,{hideSuccessNotification:!0,hideLoadingBar:!0});$(`.used-mandatory-credit[data-cid=${a}]`).text(t.used_mandatory_credit),$(`.total-mandatory-credit[data-cid=${a}]`).text(t.mandatory_credit),$(`.total-choice-credit[data-cid=${a}]`).text(t.choice_credit),$(`.used-choice-credit[data-cid=${a}]`).text(t.used_choice_credit)}async fetchCurriculums(){}async editData(a){S($(a.target).data("curriculum-id")),B("Edit Kurikulum");const{data:t}=await p(`${m}/${v}`,{hideSuccessNotification:!0,hideLoadingBar:!0});$('input[name="name"]').val(t.curriculum.name),$('input[name="mandatory_credit"]').val(t.curriculum.mandatory_credit).trigger("keyup"),$('input[name="choice_credit"]').val(t.curriculum.choice_credit).trigger("keyup"),$('input[name="academic_period_id"]').val(t.curriculum.academic_period_hashid),$('input[name="study_program_id"]').val(t.curriculum.study_program_id),$(".js-choices")[2].choices.setChoiceByValue(t.curriculum.academic_period_hashid),$("#curriculum-modal").modal("show")}componentDidMount(){if(Object.keys(this.tables).length)for(const a in this.tables)this.tables[a].destroy();if(this.curriculums.length)for(const a of this.curriculums)this.tables[a.id]=U(`#data-${a.id}`,W(this.editCourseCurriculum,this.deleteCourseCurriculum,"",`/lecture/course-curriculums?curriculum_id=${a.id}`))}async submit(a){a.preventDefault();let t;document.querySelector("#study-program-id-modal").value=d,v==""?t=await b(`${m}`,a.target):t=await b(`${m}/${v}`,a.target),t.status==200&&this.filterCurriculum()}async submitCourseCurriculum(a){a.preventDefault();let t;_==""?($('input[name="curriculum_id"]').val(y),t=await b("lecture/course-curriculums",a.target)):t=await b(`lecture/course-curriculums/${_}`,a.target),t.status==200&&(this.tables[y].ajax.reload(),this.recountCreditTotal(y))}async deleteData(a){f.fire({title:"Hapus ?",icon:"question",text:"Data yang dihapus tidak dikembalikan!",showConfirmButton:!0,showCancelButton:!0,confirmButtonText:"Ya, lanjutkan",cancelButtonText:"Batal",confirmButtonColor:"#d1403b"}).then(async t=>{t.isConfirmed&&(await P(`${m}/${$(a.target).data("curriculum-id")}`),this.filterCurriculum())})}}n(Y,"defaultProps",{...V(["getData","getAcademicPeriods"]),studyPrograms:[],curriculums:[],academicPeriods:[],tables:{},courses:[]});export{Y as default};
